<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <title>Test coverage report: south.creator.actions</title>
    <style type="text/css" media="screen">
      a
      {
        color: #3d707a;
      }
      
      a:hover, a:active
      {
        color: #bf7d18;
      }
    
      body 
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        font-size: 13px;
      }
      
      .nav 
      {
        font-size: 12px;
        margin-left: 50px;
      }

      .ignored
      {
        color: #707070;
      }

      .executed 
      {
        color: #3d9900;
      }

      .missed 
      {
        color: red;
        font-weight: bold;
      }

      .excluded 
      {
        color: #6090f0;
        font-weight: lighter;
      }
    
      #content-header 
      {
        font-size: 12px;
        padding: 18px 0 18px 50px;
      }

      #content-header h1 
      {
        font-size: 16px;
        margin: 10px 0 0 0;
        color: #909090;
      }
      
      #module-name
      {
        color: #583707;
      }
    
      #content-header p
      {
        font-size: 13px;
        margin: 0;
        color: #909090;
      }

      #content-header .normal 
      {
        color: #609030;
      }

      #content-header .warning 
      {
        color: #d0a000;
      }

      #content-header .critical 
      {
        color: red;
      }
      
      #source-listing 
      {
        margin-bottom: 24px;
      }

      #source-listing ol 
      {
        padding: 0 0 0 50px;
        width: 90%;
        font-family: monospace;
        list-style-position: outside;
      }

      #source-listing ol li 
      {
        line-height: 18px;
        font-size: small;
      }
        
      #source-listing ol code 
      {
        padding:  0 .001em 0 0; /* Firefox doesn't render empty li's properly */
        font-size: medium;
        white-space: pre;
      }
   </style>
  </head>

  <body>

<div class="nav">
  <a href="FrontEnd.views.html">FrontEnd.views</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="south.creator.changes.html">south.creator.changes</a>
</div>

<div id="content-header">
  <h1>
    <span id="module-name">south.creator.actions</span>:
    218 total statements,
    <span class="critical">0.0% covered</span>
  </h1>
  <p>Generated: Sat 2014-12-06 15:16 UTC</p>
  <p>Source file: /home/nkt/venv/lib/python2.7/site-packages/south/creator/actions.py</p>
  <p>
    Stats:
    <span class="executed">0 executed</span>,
    <span class="missed">210 missed</span>,
    <span class="excluded">8 excluded</span>,
    <span class="ignored">341 ignored</span> 
  </p> 
</div>

<div id="source-listing">
  <ol>
    <li class="ignored"><code>"""</code></li>
<li class="ignored"><code>Actions - things like 'a model was removed' or 'a field was changed'.</code></li>
<li class="ignored"><code>Each one has a class, which can take the action description and insert code</code></li>
<li class="ignored"><code>blocks into the forwards() and backwards() methods, in the right place.</code></li>
<li class="ignored"><code>"""</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>from __future__ import print_function</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>import sys</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>from django.db.models.fields.related import RECURSIVE_RELATIONSHIP_CONSTANT</code></li>
<li class="excluded"><code>from django.db.models.fields import FieldDoesNotExist, NOT_PROVIDED, CharField, TextField</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>from south.modelsinspector import value_clean</code></li>
<li class="excluded"><code>from south.creator.freezer import remove_useless_attributes, model_key</code></li>
<li class="excluded"><code>from south.utils import datetime_utils</code></li>
<li class="excluded"><code>from south.utils.py3 import raw_input</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class Action(object):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Generic base Action class. Contains utility methods for inserting into</code></li>
<li class="ignored"><code>    the forwards() and backwards() method lists.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    prepend_forwards = False</code></li>
<li class="missed"><code>    prepend_backwards = False</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="missed"><code>        raise NotImplementedError</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        raise NotImplementedError</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def add_forwards(self, forwards):</code></li>
<li class="missed"><code>        if self.prepend_forwards:</code></li>
<li class="missed"><code>            forwards.insert(0, self.forwards_code())</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            forwards.append(self.forwards_code())</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def add_backwards(self, backwards):</code></li>
<li class="missed"><code>        if self.prepend_backwards:</code></li>
<li class="missed"><code>            backwards.insert(0, self.backwards_code())</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            backwards.append(self.backwards_code())</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        raise NotImplementedError</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    @classmethod</code></li>
<li class="ignored"><code>    def triples_to_defs(cls, fields):</code></li>
<li class="ignored"><code>        # Turn the (class, args, kwargs) format into a string</code></li>
<li class="missed"><code>        for field, triple in fields.items():</code></li>
<li class="missed"><code>            fields[field] = cls.triple_to_def(triple)</code></li>
<li class="missed"><code>        return fields</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    @classmethod</code></li>
<li class="ignored"><code>    def triple_to_def(cls, triple):</code></li>
<li class="ignored"><code>        "Turns a single triple into a definition."</code></li>
<li class="missed"><code>        return "self.gf(%r)(%s)" % (</code></li>
<li class="ignored"><code>            triple[0], # Field full path</code></li>
<li class="ignored"><code>            ", ".join(triple[1] + ["%s=%s" % (kwd, val) for kwd, val in triple[2].items()]), # args and kwds</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class AddModel(Action):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Addition of a model. Takes the Model subclass that is being created.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    FORWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Adding model '%(model_name)s'</code></li>
<li class="ignored"><code>        db.create_table(%(table_name)r, (</code></li>
<li class="ignored"><code>            %(field_defs)s</code></li>
<li class="ignored"><code>        ))</code></li>
<li class="ignored"><code>        db.send_create_signal(%(app_label)r, [%(model_name)r])'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    BACKWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Deleting model '%(model_name)s'</code></li>
<li class="ignored"><code>        db.delete_table(%(table_name)r)'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def __init__(self, model, model_def):</code></li>
<li class="missed"><code>        self.model = model</code></li>
<li class="missed"><code>        self.model_def = model_def</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " + Added model %s.%s" % (</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="ignored"><code>        "Produces the code snippet that gets put into forwards()"</code></li>
<li class="missed"><code>        field_defs = ",\n            ".join([</code></li>
<li class="ignored"><code>            "(%r, %s)" % (name, defn) for name, defn</code></li>
<li class="ignored"><code>            in self.triples_to_defs(self.model_def).items()</code></li>
<li class="ignored"><code>        ]) + ","</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return self.FORWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>            "app_label": self.model._meta.app_label,</code></li>
<li class="ignored"><code>            "field_defs": field_defs,</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="ignored"><code>        "Produces the code snippet that gets put into backwards()"</code></li>
<li class="missed"><code>        return self.BACKWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class DeleteModel(AddModel):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Deletion of a model. Takes the Model subclass that is being created.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " - Deleted model %s.%s" % (</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="missed"><code>        return AddModel.backwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        return AddModel.forwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class _NullIssuesField(object):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    A field that might need to ask a question about rogue NULL values.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    issue_with_backward_migration = False</code></li>
<li class="missed"><code>    irreversible = False</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    IRREVERSIBLE_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # User chose to not deal with backwards NULL issues for '%(model_name)s.%(field_name)s'</code></li>
<li class="ignored"><code>        raise RuntimeError("Cannot reverse this migration. '%(model_name)s.%(field_name)s' and its values cannot be restored.")</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        # The following code is provided here to aid in writing a correct migration'''</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def deal_with_not_null_no_default(self, field, field_def):</code></li>
<li class="ignored"><code>        # If it's a CharField or TextField that's blank, skip this step.</code></li>
<li class="missed"><code>        if isinstance(field, (CharField, TextField)) and field.blank:</code></li>
<li class="missed"><code>            field_def[2]['default'] = repr("")</code></li>
<li class="missed"><code>            return</code></li>
<li class="ignored"><code>        # Oh dear. Ask them what to do.</code></li>
<li class="missed"><code>        print(" ? The field '%s.%s' does not have a default specified, yet is NOT NULL." % (</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>            field.name,</code></li>
<li class="ignored"><code>        ))</code></li>
<li class="missed"><code>        print(" ? Since you are %s, you MUST specify a default" % self.null_reason)</code></li>
<li class="missed"><code>        print(" ? value to use for existing rows. Would you like to:")</code></li>
<li class="missed"><code>        print(" ?  1. Quit now"+("." if self.issue_with_backward_migration else ", and add a default to the field in models.py" ))</code></li>
<li class="missed"><code>        print(" ?  2. Specify a one-off value to use for existing columns now")</code></li>
<li class="missed"><code>        if self.issue_with_backward_migration:</code></li>
<li class="missed"><code>            print(" ?  3. Disable the backwards migration by raising an exception; you can edit the migration to fix it later")</code></li>
<li class="missed"><code>        while True:</code></li>
<li class="missed"><code>            choice = raw_input(" ? Please select a choice: ")</code></li>
<li class="missed"><code>            if choice == "1":</code></li>
<li class="missed"><code>                sys.exit(1)</code></li>
<li class="missed"><code>            elif choice == "2":</code></li>
<li class="missed"><code>                break</code></li>
<li class="missed"><code>            elif choice == "3" and self.issue_with_backward_migration:</code></li>
<li class="missed"><code>                break</code></li>
<li class="ignored"><code>            else:</code></li>
<li class="missed"><code>                print(" ! Invalid choice.")</code></li>
<li class="missed"><code>        if choice == "2":</code></li>
<li class="missed"><code>            self.add_one_time_default(field, field_def)</code></li>
<li class="missed"><code>        elif choice == "3":</code></li>
<li class="missed"><code>            self.irreversible = True</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def add_one_time_default(self, field, field_def):</code></li>
<li class="ignored"><code>        # OK, they want to pick their own one-time default. Who are we to refuse?</code></li>
<li class="missed"><code>        print(" ? Please enter Python code for your one-off default value.")</code></li>
<li class="missed"><code>        print(" ? The datetime module is available, so you can do e.g. datetime.date.today()")</code></li>
<li class="missed"><code>        while True:</code></li>
<li class="missed"><code>            code = raw_input(" &gt;&gt;&gt; ")</code></li>
<li class="missed"><code>            if not code:</code></li>
<li class="missed"><code>                print(" ! Please enter some code, or 'exit' (with no quotes) to exit.")</code></li>
<li class="missed"><code>            elif code == "exit":</code></li>
<li class="missed"><code>                sys.exit(1)</code></li>
<li class="ignored"><code>            else:</code></li>
<li class="missed"><code>                try:</code></li>
<li class="missed"><code>                    result = eval(code, {}, {"datetime": datetime_utils})</code></li>
<li class="missed"><code>                except (SyntaxError, NameError) as e:</code></li>
<li class="missed"><code>                    print(" ! Invalid input: %s" % e)</code></li>
<li class="ignored"><code>                else:</code></li>
<li class="missed"><code>                    break</code></li>
<li class="ignored"><code>        # Right, add the default in.</code></li>
<li class="missed"><code>        field_def[2]['default'] = value_clean(result)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def irreversable_code(self, field):</code></li>
<li class="missed"><code>        return self.IRREVERSIBLE_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>            "field_name": field.name,</code></li>
<li class="ignored"><code>            "field_column": field.column,</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class AddField(Action, _NullIssuesField):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Adds a field to a model. Takes a Model class and the field name.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    null_reason = "adding this field"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    FORWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Adding field '%(model_name)s.%(field_name)s'</code></li>
<li class="ignored"><code>        db.add_column(%(table_name)r, %(field_name)r,</code></li>
<li class="ignored"><code>                      %(field_def)s,</code></li>
<li class="ignored"><code>                      keep_default=False)'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    BACKWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Deleting field '%(model_name)s.%(field_name)s'</code></li>
<li class="ignored"><code>        db.delete_column(%(table_name)r, %(field_column)r)'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def __init__(self, model, field, field_def):</code></li>
<li class="missed"><code>        self.model = model</code></li>
<li class="missed"><code>        self.field = field</code></li>
<li class="missed"><code>        self.field_def = field_def</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        # See if they've made a NOT NULL column but also have no default (far too common)</code></li>
<li class="missed"><code>        is_null = self.field.null</code></li>
<li class="missed"><code>        default = (self.field.default is not None) and (self.field.default is not NOT_PROVIDED)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        if not is_null and not default:</code></li>
<li class="missed"><code>            self.deal_with_not_null_no_default(self.field, self.field_def)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " + Added field %s on %s.%s" % (</code></li>
<li class="ignored"><code>            self.field.name,</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return self.FORWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>            "field_name": self.field.name,</code></li>
<li class="ignored"><code>            "field_column": self.field.column,</code></li>
<li class="ignored"><code>            "field_def": self.triple_to_def(self.field_def),</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        return self.BACKWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>            "field_name": self.field.name,</code></li>
<li class="ignored"><code>            "field_column": self.field.column,</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class DeleteField(AddField):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Removes a field from a model. Takes a Model class and the field name.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    null_reason = "removing this field"</code></li>
<li class="missed"><code>    issue_with_backward_migration = True</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " - Deleted field %s on %s.%s" % (</code></li>
<li class="ignored"><code>            self.field.name,</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="missed"><code>        return AddField.backwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        if not self.irreversible:</code></li>
<li class="missed"><code>            return AddField.forwards_code(self)</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            return self.irreversable_code(self.field) + AddField.forwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class ChangeField(Action, _NullIssuesField):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Changes a field's type/options on a model.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    null_reason = "making this field non-nullable"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    FORWARDS_TEMPLATE = BACKWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Changing field '%(model_name)s.%(field_name)s'</code></li>
<li class="ignored"><code>        db.alter_column(%(table_name)r, %(field_column)r, %(field_def)s)'''</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    RENAME_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Renaming column for '%(model_name)s.%(field_name)s' to match new field type.</code></li>
<li class="ignored"><code>        db.rename_column(%(table_name)r, %(old_column)r, %(new_column)r)'''</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def __init__(self, model, old_field, new_field, old_def, new_def):</code></li>
<li class="missed"><code>        self.model = model</code></li>
<li class="missed"><code>        self.old_field = old_field</code></li>
<li class="missed"><code>        self.new_field = new_field</code></li>
<li class="missed"><code>        self.old_def = old_def</code></li>
<li class="missed"><code>        self.new_def = new_def</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        # See if they've changed a not-null field to be null</code></li>
<li class="missed"><code>        new_default = (self.new_field.default is not None) and (self.new_field.default is not NOT_PROVIDED)</code></li>
<li class="missed"><code>        old_default = (self.old_field.default is not None) and (self.old_field.default is not NOT_PROVIDED)</code></li>
<li class="missed"><code>        if self.old_field.null and not self.new_field.null and not new_default:</code></li>
<li class="missed"><code>            self.deal_with_not_null_no_default(self.new_field, self.new_def)</code></li>
<li class="missed"><code>        if not self.old_field.null and self.new_field.null and not old_default:</code></li>
<li class="missed"><code>            self.null_reason = "making this field nullable"</code></li>
<li class="missed"><code>            self.issue_with_backward_migration = True</code></li>
<li class="missed"><code>            self.deal_with_not_null_no_default(self.old_field, self.old_def)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " ~ Changed field %s on %s.%s" % (</code></li>
<li class="ignored"><code>            self.new_field.name,</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def _code(self, old_field, new_field, new_def):</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        output = ""</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        if self.old_field.column != self.new_field.column:</code></li>
<li class="missed"><code>            output += self.RENAME_TEMPLATE % {</code></li>
<li class="ignored"><code>                "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>                "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>                "field_name": new_field.name,</code></li>
<li class="ignored"><code>                "old_column": old_field.column,</code></li>
<li class="ignored"><code>                "new_column": new_field.column,</code></li>
<li class="ignored"><code>            }</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        output += self.FORWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>            "field_name": new_field.name,</code></li>
<li class="ignored"><code>            "field_column": new_field.column,</code></li>
<li class="ignored"><code>            "field_def": self.triple_to_def(new_def),</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return output</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="missed"><code>        return self._code(self.old_field, self.new_field, self.new_def)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        change_code = self._code(self.new_field, self.old_field, self.old_def)</code></li>
<li class="missed"><code>        if not self.irreversible:</code></li>
<li class="missed"><code>            return change_code</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            return self.irreversable_code(self.old_field) + change_code</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class AddUnique(Action):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Adds a unique constraint to a model. Takes a Model class and the field names.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    FORWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Adding unique constraint on '%(model_name)s', fields %(field_names)s</code></li>
<li class="ignored"><code>        db.create_unique(%(table_name)r, %(fields)r)'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    BACKWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Removing unique constraint on '%(model_name)s', fields %(field_names)s</code></li>
<li class="ignored"><code>        db.delete_unique(%(table_name)r, %(fields)r)'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    prepend_backwards = True</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def __init__(self, model, fields):</code></li>
<li class="missed"><code>        self.model = model</code></li>
<li class="missed"><code>        self.fields = fields</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " + Added unique constraint for %s on %s.%s" % (</code></li>
<li class="ignored"><code>            [x.name for x in self.fields],</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return self.FORWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>            "fields":  [field.column for field in self.fields],</code></li>
<li class="ignored"><code>            "field_names":  [field.name for field in self.fields],</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        return self.BACKWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "table_name": self.model._meta.db_table,</code></li>
<li class="ignored"><code>            "fields": [field.column for field in self.fields],</code></li>
<li class="ignored"><code>            "field_names":  [field.name for field in self.fields],</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class DeleteUnique(AddUnique):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Removes a unique constraint from a model. Takes a Model class and the field names.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    prepend_forwards = True</code></li>
<li class="missed"><code>    prepend_backwards = False</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " - Deleted unique constraint for %s on %s.%s" % (</code></li>
<li class="ignored"><code>            [x.name for x in self.fields],</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="missed"><code>        return AddUnique.backwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        return AddUnique.forwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class AddIndex(AddUnique):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Adds an index to a model field[s]. Takes a Model class and the field names.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    FORWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Adding index on '%(model_name)s', fields %(field_names)s</code></li>
<li class="ignored"><code>        db.create_index(%(table_name)r, %(fields)r)'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    BACKWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Removing index on '%(model_name)s', fields %(field_names)s</code></li>
<li class="ignored"><code>        db.delete_index(%(table_name)r, %(fields)r)'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " + Added index for %s on %s.%s" % (</code></li>
<li class="ignored"><code>            [x.name for x in self.fields],</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class DeleteIndex(AddIndex):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Deletes an index off a model field[s]. Takes a Model class and the field names.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " + Deleted index for %s on %s.%s" % (</code></li>
<li class="ignored"><code>            [x.name for x in self.fields],</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="missed"><code>        return AddIndex.backwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        return AddIndex.forwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class AddM2M(Action):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Adds a unique constraint to a model. Takes a Model class and the field names.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    FORWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Adding M2M table for field %(field_name)s on '%(model_name)s'</code></li>
<li class="ignored"><code>        m2m_table_name = %(table_name)s</code></li>
<li class="ignored"><code>        db.create_table(m2m_table_name, (</code></li>
<li class="ignored"><code>            ('id', models.AutoField(verbose_name='ID', primary_key=True, auto_created=True)),</code></li>
<li class="ignored"><code>            (%(left_field)r, models.ForeignKey(orm[%(left_model_key)r], null=False)),</code></li>
<li class="ignored"><code>            (%(right_field)r, models.ForeignKey(orm[%(right_model_key)r], null=False))</code></li>
<li class="ignored"><code>        ))</code></li>
<li class="ignored"><code>        db.create_unique(m2m_table_name, [%(left_column)r, %(right_column)r])'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    BACKWARDS_TEMPLATE = '''</code></li>
<li class="ignored"><code>        # Removing M2M table for field %(field_name)s on '%(model_name)s'</code></li>
<li class="ignored"><code>        db.delete_table(%(table_name)s)'''[1:] + "\n"</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def __init__(self, model, field):</code></li>
<li class="missed"><code>        self.model = model</code></li>
<li class="missed"><code>        self.field = field</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " + Added M2M table for %s on %s.%s" % (</code></li>
<li class="ignored"><code>            self.field.name,</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def table_name(self):</code></li>
<li class="ignored"><code>        # This is part of a workaround for the fact that Django uses</code></li>
<li class="ignored"><code>        # different shortening for automatically generated m2m table names</code></li>
<li class="ignored"><code>        # (as opposed to any explicitly specified table name)</code></li>
<li class="missed"><code>        f = self.field</code></li>
<li class="missed"><code>        explicit = f.db_table</code></li>
<li class="missed"><code>        if explicit:</code></li>
<li class="missed"><code>            return "%r" % explicit</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            auto = "%s_%s" % (self.model._meta.db_table, f.name)</code></li>
<li class="missed"><code>            return 'db.shorten_name(%r)' % auto</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return self.FORWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "field_name": self.field.name,</code></li>
<li class="ignored"><code>            "table_name": self.table_name(),</code></li>
<li class="ignored"><code>            "left_field": self.field.m2m_column_name()[:-3], # Remove the _id part</code></li>
<li class="ignored"><code>            "left_column": self.field.m2m_column_name(),</code></li>
<li class="ignored"><code>            "left_model_key": model_key(self.model),</code></li>
<li class="ignored"><code>            "right_field": self.field.m2m_reverse_name()[:-3], # Remove the _id part</code></li>
<li class="ignored"><code>            "right_column": self.field.m2m_reverse_name(),</code></li>
<li class="ignored"><code>            "right_model_key": model_key(self.field.rel.to),</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return self.BACKWARDS_TEMPLATE % {</code></li>
<li class="ignored"><code>            "model_name": self.model._meta.object_name,</code></li>
<li class="ignored"><code>            "field_name": self.field.name,</code></li>
<li class="ignored"><code>            "table_name": self.table_name(),</code></li>
<li class="ignored"><code>        }</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class DeleteM2M(AddM2M):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Adds a unique constraint to a model. Takes a Model class and the field names.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def console_line(self):</code></li>
<li class="ignored"><code>        "Returns the string to print on the console, e.g. ' + Added field foo'"</code></li>
<li class="missed"><code>        return " - Deleted M2M table for %s on %s.%s" % (</code></li>
<li class="ignored"><code>            self.field.name,</code></li>
<li class="ignored"><code>            self.model._meta.app_label,</code></li>
<li class="ignored"><code>            self.model._meta.object_name,</code></li>
<li class="ignored"><code>        )</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def forwards_code(self):</code></li>
<li class="missed"><code>        return AddM2M.backwards_code(self)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def backwards_code(self):</code></li>
<li class="missed"><code>        return AddM2M.forwards_code(self)</code></li>
<li class="ignored"><code></code></li>
  </ol>
</div>

<div class="nav">
  <a href="FrontEnd.views.html">FrontEnd.views</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="south.creator.changes.html">south.creator.changes</a>
</div>

  </body>
</html>

